datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// ... (User)
model User {
  id            String    @id @default(cuid())
  email         String    @unique
  password      String    // Hashed
  name          String?
  createdAt     DateTime  @default(now())
  
  projects      Project[]
  ownedProjects Project[] @relation("ProjectOwner")
  
  // Audit relations
  modifiedKeys    TranslationKey[]   @relation("KeyModifiers")
  modifiedValues  TranslationValue[]  @relation("ValueModifiers")
}

model Project {
  id               String   @id @default(cuid())
  name             String
  description      String?
  
  // Visibility: public = anyone can view & edit; private = all can view, only owner can edit
  visibility       String   @default("public") // "public" | "private"
  ownerId          String?
  owner            User?    @relation("ProjectOwner", fields: [ownerId], references: [id], onDelete: SetNull)
  
  // Config
  baseLanguage     String   @default("en-US")
  targetLanguages  String   @default("[]") // JSON string of language codes: ["zh-CN", "ja"]
  
  // AI Config (Project specific)
  aiBaseUrl        String?
  aiApiKey         String?
  aiModelId        String?
  systemPrompt     String?

  // Relations
  users            User[]
  keys             TranslationKey[]
  
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}

model TranslationKey {
  id            String   @id @default(cuid())
  stringName    String   
  remarks       String?  
  
  projectId     String
  project       Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  
  values        TranslationValue[]

  // Audit
  lastModifiedById String?
  lastModifiedBy   User?   @relation("KeyModifiers", fields: [lastModifiedById], references: [id])
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@unique([projectId, stringName])
  @@index([stringName])
}

model TranslationValue {
  id               String         @id @default(cuid())
  languageCode     String         
  content          String?
  
  translationKeyId String
  translationKey   TranslationKey @relation(fields: [translationKeyId], references: [id], onDelete: Cascade)

  // Audit
  lastModifiedById String?
  lastModifiedBy   User?   @relation("ValueModifiers", fields: [lastModifiedById], references: [id])

  @@unique([translationKeyId, languageCode])
}
